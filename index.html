<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ë±€íŒŒì´ì–´ ì €íƒ ë¯¸ë¡œ</title>

<style>
body{
  margin:0;
  background:#000;
  color:#f1d9de;
  font-family:"Apple SD Gothic Neo","Noto Sans KR","Pretendard",sans-serif;
  text-align:center;
}
button,a{
  background:#7a1f2b;
  color:#000;
  padding:14px 28px;
  border-radius:14px;
  border:none;
  font-size:16px;
  font-weight:600;
  text-decoration:none;
}
input{
  padding:12px;
  border-radius:10px;
  border:none;
  font-size:15px;
  width:220px;
  margin-top:18px;
  text-align:center;
}
.screen{
  min-height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  padding:24px;
}
.narration{
  max-width:420px;
  font-size:18px;
  line-height:1.8;
  white-space:pre-line;
}
.maze{
  display:grid;
  gap:2px;
}
.cell{
  width:28px;height:28px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.wall{background:#2a0006;}
.path{background:#111;}
.controls{
  margin-top:16px;
  display:grid;
  grid-template-columns:repeat(3,36px);
  gap:6px;
}
.controls button{
  padding:0;
  width:36px;
  height:28px;
  font-size:14px;
}
.rank{
  margin-top:24px;
  font-size:14px;
  line-height:1.6;
}
</style>
</head>

<body>
<div id="app"></div>

<script>
const GRID=11;
const START={x:0,y:10};
const GOAL={x:10,y:0};

const MAZE=[
 [1,1,1,1,1,1,1,1,1,1,0],
 [1,0,0,0,1,0,0,0,0,1,0],
 [1,0,1,0,1,0,1,1,0,1,0],
 [1,0,0,0,0,0,0,0,0,0,0],
 [1,0,1,1,1,1,0,1,1,1,1],
 [1,0,0,0,0,0,0,0,0,0,1],
 [1,1,1,1,1,1,1,1,1,0,1],
 [1,0,0,0,0,0,0,0,1,0,1],
 [1,0,1,1,1,1,1,0,1,0,1],
 [1,0,0,0,0,0,0,0,0,0,1],
 [0,0,1,1,1,1,1,1,1,1,1],
];

const narration=
"íƒœì´ˆì˜ ë±€íŒŒì´ì–´ë¥¼ ë°©ë¬¸í•˜ê²Œ ëœ ë‹¹ì‹ ,\n"+
"í•˜ì§€ë§Œ ì €íƒì€ ìƒê°ë³´ë‹¤ ì™¸ì§„ ê³³ì— ìˆëŠ”ë°...\n"+
"ê³¼ì—° ì‹œê°„ ë‚´ì— ê¸¸ì„ ì°¾ì•„ê°ˆ ìˆ˜ ìˆì„ê¹Œ?";

let stage="intro",text="",i=0;
let nickname="",showButton=false;
let pos={...START};
let startTime=0,elapsed=0;

const app=document.getElementById("app");

/* INTRO */
function renderIntro(){
  app.innerHTML=`
  <div class="screen">
    <div class="narration">${text}</div>
    ${text.length===narration.length?`
      <input id="nick" placeholder="ë‹‰ë„¤ì„ ì…ë ¥í•˜ê¸°"/>
      ${showButton?`<button id="go" style="margin-top:18px">ì €íƒìœ¼ë¡œ í–¥í•˜ê¸°</button>`:""}
    `:""}
  </div>`;
  const nick=document.getElementById("nick");
  if(nick){
    nick.focus();
    nick.onkeydown=e=>{
      if(e.key==="Enter"&&nick.value.trim()){
        nickname=nick.value.trim();
        showButton=true;
        renderIntro();
      }
    }
  }
  const go=document.getElementById("go");
  if(go) go.onclick=startGame;
}

/* MAZE */
function renderMaze(){
  let html=`<div class="screen">
  <div class="maze" style="grid-template-columns:repeat(${GRID},28px)">`;
  for(let y=0;y<GRID;y++){
    for(let x=0;x<GRID;x++){
      let c="";
      if(pos.x===x&&pos.y===y)c="ğŸ‘§";
      if(x===GOAL.x&&y===GOAL.y)c="ğŸ°";
      html+=`<div class="cell ${MAZE[y][x]?"wall":"path"}">${c}</div>`;
    }
  }
  html+=`</div>
  <div class="controls">
    <div></div><button onclick="move(0,-1)">â–²</button><div></div>
    <button onclick="move(-1,0)">â—€</button><div></div><button onclick="move(1,0)">â–¶</button>
    <div></div><button onclick="move(0,1)">â–¼</button><div></div>
  </div></div>`;
  app.innerHTML=html;
}

function move(dx,dy){
  let nx=pos.x+dx, ny=pos.y+dy;
  if(nx<0||ny<0||nx>=GRID||ny>=GRID) return;
  if(MAZE[ny][nx]) return;
  pos={x:nx,y:ny};

  if(nx===GOAL.x&&ny===GOAL.y){
    elapsed=Math.floor((Date.now()-startTime)/1000);
    saveRanking();
    renderResult();
    return;
  }
  renderMaze();
}

/* RESULT */
function saveRanking(){
  const list=JSON.parse(localStorage.getItem("vampireRank")||"[]");
  list.push({name:nickname,time:elapsed});
  list.sort((a,b)=>a.time-b.time);
  localStorage.setItem("vampireRank",JSON.stringify(list.slice(0,5)));
}

function renderResult(){
  const list=JSON.parse(localStorage.getItem("vampireRank")||"[]");
  app.innerHTML=`
  <div class="screen">
    <div class="narration">
      ${nickname}ë‹˜ì€<br/>
      ${elapsed}ì´ˆ ë§Œì—<br/>
      ì €íƒì— ë„ì°©í–ˆìŠµë‹ˆë‹¤.
    </div>

    <div class="rank">
      <strong>ğŸ† ë°©ë¬¸ì ë­í‚¹</strong><br/>
      ${list.map((r,i)=>`${i+1}ìœ„ Â· ${r.name} (${r.time}ì´ˆ)`).join("<br/>")}
    </div>

    <div class="narration" style="margin-top:24px;font-size:15px">
      ë¬´ì‚¬íˆ ë±€íŒŒì´ì–´ì˜ ì €íƒì„ ë°©ë¬¸í•˜ê³  ë‚˜ì„œ<br/>
      ë²Œì–´ì§€ëŠ” ì¼ì´ ê¶ê¸ˆí•˜ë‹¤ë©´?<br/>
      <strong>ì—°ê·¹ &lt;ë±€íŒŒì´ì–´ë¥¼ ì´í•´í•˜ëŠ” íŠ¹ë³„í•œ ë°©ë²•&gt;</strong><br/>
      ë§ì€ ê´€ì‹¬ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
    </div>

    <a href="https://tickets.interpark.com/goods/26000875"
       target="_blank"
       style="margin-top:22px">
       í‹°ì¼“ ì˜¤í”ˆ ì‚¬ì´íŠ¸ ë°”ë¡œê°€ê¸°
    </a>
  </div>`;
}

/* START */
function startGame(){
  stage="maze";
  startTime=Date.now();
  renderMaze();
}

const timer=setInterval(()=>{
  if(i<narration.length){
    text+=narration[i++];
    renderIntro();
  } else clearInterval(timer);
},40);

renderIntro();
</script>
</body>
</html>


